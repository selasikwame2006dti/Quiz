
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entrepreneurship Exam Prep Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <!-- Open Graph Meta Tags for Link Preview -->
    <meta property="og:title" content="Entrepreneurship Quiz Challenge!">
    <meta property="og:description" content="Test your knowledge on small business management, leadership, ethics, and more! Prepare for your exams with this interactive quiz.">
    <meta property="og:image" content="https://placehold.co/1200x630/2563eb/ffffff?text=Entrepreneurship+Quiz">
    <meta property="og:url" content="https://quiz-v0g4.onrender.com"> <!-- IMPORTANT: Update with your actual quiz URL -->
    <meta property="og:type" content="website">
    <!-- End Open Graph Meta Tags -->

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
            overflow-x: hidden;
        }
        .quiz-container {
            background-color: #ffffff;
            border-radius: 1.5rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            padding: 2rem;
            width: 100%;
            max-width: 600px;
            text-align: center;
            transition: all 0.5s ease-in-out;
            opacity: 0;
            transform: translateY(20px);
        }
        .quiz-container.show {
            opacity: 1;
            transform: translateY(0);
        }
        .option-button {
            background-color: #e2e8f0;
            color: #334155;
            padding: 0.75rem 1.25rem;
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            text-align: left;
            width: 100%;
            /* Responsive font size for options */
            font-size: 1rem; /* Base size for mobile (text-base) */
            @media (min-width: 640px) { /* sm breakpoint */
                font-size: 1.125rem; /* text-lg */
            }
            border: 1px solid transparent;
        }
        .option-button:hover:not(.disabled) {
            background-color: #cbd5e1;
            transform: translateY(-2px);
        }
        .option-button.correct {
            background-color: #d1fae5;
            color: #065f46;
            border-color: #34d399;
        }
        .option-button.incorrect {
            background-color: #fee2e2;
            color: #991b1b;
            border-color: #ef4444;
        }
        .option-button.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        #timer-bar {
            transition: width 1s linear; /* Animate width change over 1 second */
        }
        .time-low-pulse {
             background-image: linear-gradient(to right, #ef4444, #b91c1c);
             animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }
        .score-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            background-color: #f8fafc;
            border-radius: 1.5rem;
            margin-top: 2rem;
            box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
            opacity: 0;
            transform: scale(0.9);
            transition: all 0.5s ease-in-out;
        }
        .score-card.show {
            opacity: 1;
            transform: scale(1);
        }
        .score-icon {
            width: 80px;
            height: 80px;
            margin-bottom: 1.5rem;
        }
        .start-button {
            background-color: #4f46e5;
            color: white;
            padding: 1rem 2rem;
            border-radius: 0.75rem;
            font-size: 1.25rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .start-button:hover {
            background-color: #4338ca;
            transform: translateY(-2px);
        }
        .start-button:active {
            transform: translateY(0);
            box-shadow: none;
        }
        .social-share-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
            flex-wrap: wrap; /* Added for responsiveness */
        }
        .social-share-buttons button {
            background-color: #6b7280;
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: background-color 0.3s ease;
            flex-grow: 1; /* Allow buttons to grow */
            justify-content: center; /* Center content in buttons */
        }
        .social-share-buttons button:hover {
            background-color: #4b5563;
        }
        .social-share-buttons .whatsapp { background-color: #25D366; }
        .social-share-buttons .whatsapp:hover { background-color: #1DA851; }
        .social-share-buttons .facebook { background-color: #1877F2; }
        .social-share-buttons .facebook:hover { background-color: #145CB3; }
        .social-share-buttons .pinterest { background-color: #E60023; }
        .social-share-buttons .pinterest:hover { background-color: #B3001C; }
        .social-share-buttons .teams { background-color: #6264A7; }
        .social-share-buttons .teams:hover { background-color: #4A4C84; }

        .challenge-info {
            background-color: #e0f2fe;
            border: 1px solid #90cdf4;
            color: #2c5282;
            padding: 1rem;
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
            font-size: 1.1rem;
            font-weight: 600;
        }
        .input-field {
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 1.5rem;
            border: 1px solid #cbd5e1;
            border-radius: 0.75rem;
            font-size: 1.1rem;
            text-align: center;
        }
        @media (max-width: 640px) {
            .quiz-container { padding: 1.5rem; }
            .option-button { font-size: 1rem; padding: 0.6rem 1rem; }
            .score-icon { width: 60px; height: 60px; }
            .start-button { padding: 0.8rem 1.5rem; font-size: 1.1rem; }
            .social-share-buttons { flex-wrap: wrap; }
            .social-share-buttons button { width: calc(50% - 0.5rem); justify-content: center; }
        }

        /* Color classes for score */
        .text-red-600 { color: #dc2626; }
        .text-orange-600 { color: #ea580c; }
        .text-yellow-600 { color: #eab308; }
        .text-lime-600 { color: #65a30d; }
        .text-green-600 { color: #16a34a; }

        /* Modal styling */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.75);
        }
        .modal-content {
            max-height: 90vh;
            overflow-y: auto;
        }

        /* Fill-in-the-blank specific styles */
        .blank-placeholder {
            display: inline-block;
            min-width: 50px; /* Ensure blank has some width */
            text-decoration: none; /* Remove default underline */
            background-color: #f8fafc; /* Light background for the blank */
            border: 1px solid #cbd5e1; /* Subtle border */
            border-radius: 4px; /* Slightly rounded corners */
            padding: 2px 6px; /* Internal padding */
            color: #2563eb; /* Blue for filled text */
            font-weight: 600;
            margin: 0 4px; /* Space around blanks */
            transition: all 0.5s ease-out; /* Animation for filling */
            opacity: 1; /* Always visible */
            transform: translateY(0); /* Always in place */
        }
        /* Style for the demo blank placeholder */
        .blank-placeholder-demo {
            display: inline-block;
            min-width: 50px;
            text-decoration: none;
            background-color: #f8fafc;
            border: 1px solid #cbd5e1;
            border-radius: 4px;
            padding: 2px 6px;
            margin: 0 4px;
            transition: all 0.5s ease-out;
            /* Initial state for demo blank */
            color: #6b7280; /* A lighter gray to indicate it's empty */
            font-weight: 400; /* Normal weight when empty */
        }
        /* Class to apply when demo blank is filled */
        .blank-placeholder-demo.filled {
            color: #2563eb; /* Blue for filled text */
            font-weight: 600; /* Bold when filled */
        }

        /* Ensure text parts and blanks flow correctly within the question */
        #question-text span {
            display: inline; /* Keep all spans inline by default */
        }
        /* Responsive font size for question text */
        #question-text {
            font-size: 1.25rem; /* text-xl for small screens */
            line-height: 1.6; /* Increased line-height for better spacing */
            text-align: center; /* Ensure text is centered */
        }
        @media (min-width: 640px) { /* sm breakpoint */
            #question-text {
                font-size: 1.5rem; /* text-2xl for larger screens */
            }
        }
        /* Container for the question text to handle centering */
        .question-text-wrapper {
            min-height: 100px; /* Maintain height */
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2rem; /* Matches mb-8 on original h2 */
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div id="quiz-app" class="quiz-container hidden"> <!-- Hidden by default, shown after guide or if guide already seen -->
        <div id="start-screen" class="text-center">
            <h1 class="text-4xl font-bold text-gray-800 mb-6">Entrepreneurship Exam Prep Quiz</h1>
            <p class="text-lg text-gray-600 mb-4">Ready to test your knowledge on small business management, leadership, ethics, and more? Let's begin!</p>
            <input type="text" id="user-name-input" class="input-field" placeholder="Enter your name to start" maxlength="30">
            <button id="start-button" class="start-button">Start Quiz</button>
        </div>

        <div id="challenge-intro-screen" class="hidden text-center">
            <h1 class="text-4xl font-bold text-gray-800 mb-6">Challenge Accepted!</h1>
            <div class="challenge-info">
                <p class="mb-2">You are challenging <span id="challenger-name-display" class="font-bold"></span>'s score of <span id="challenger-score-display" class="font-bold"></span> out of <span id="challenger-total-display" class="font-bold"></span>.</p>
                <p id="challenger-speed-display" class="mb-2"></p>
                <p id="challenger-proficiency-display" class="mb-4"></p>
                <p class="mb-4">Enter your name to take on the challenge!</p>
                <input type="text" id="challenger-name-input" class="input-field" placeholder="Your name" maxlength="30">
            </div>
            <button id="start-challenge-button" class="start-button">Start Challenge</button>
        </div>

        <div id="quiz-screen" class="hidden">
            <div id="quiz-header" class="mb-6">
                 <div class="flex justify-between items-center text-gray-600 mb-2">
                    <p id="question-count" class="text-sm font-semibold">Question 1 of 20</p>
                    <p id="timer-text" class="text-sm font-semibold">Time: 35s</p>
                </div>
                <div id="timer-container" class="w-full bg-gray-200 rounded-full h-2.5">
                     <div id="timer-bar" class="bg-gradient-to-r from-indigo-500 to-blue-500 h-2.5 rounded-full" style="width: 100%;"></div>
                </div>
            </div>
            <!-- New wrapper div for question text -->
            <div class="question-text-wrapper">
                <h2 id="question-text" class="font-semibold text-gray-900 leading-relaxed"></h2>
            </div>
            <div id="options-container" class="grid grid-cols-1 gap-4"></div>
        </div>

        <div id="score-card" class="score-card hidden">
            <div id="score-icon-display" class="score-icon"></div>
            <h3 id="score-text" class="text-3xl font-bold text-gray-800 mb-4"></h3>
            <!-- New dashboard elements -->
            <p id="average-speed-display" class="text-lg text-gray-600 mb-2"></p>
            <p id="proficiency-score-display" class="text-lg font-bold mb-4"></p>
            <!-- End new dashboard elements -->
            <p id="score-review" class="text-lg text-gray-600 mb-8"></p>
            <div id="challenge-outcome-message" class="text-xl font-semibold text-blue-700 mb-4 hidden"></div>
            <div class="flex flex-col items-center gap-4">
                <button id="review-answers-button" class="start-button bg-purple-600 hover:bg-purple-700">Review Wrong Answers</button>
                <button id="restart-button" class="start-button">Play Again</button>
                <div id="share-section" class="w-full">
                    <p class="text-gray-700 font-semibold mb-2">Share your score and challenge others!</p>
                    <div class="social-share-buttons">
                        <button id="share-whatsapp" class="whatsapp"><i class="fab fa-whatsapp"></i> WhatsApp</button>
                        <button id="share-facebook" class="facebook"><i class="fab fa-facebook-f"></i> Facebook</button>
                        <button id="share-pinterest" class="pinterest"><i class="fab fa-pinterest-p"></i> Pinterest</button>
                        <button id="share-teams" class="teams"><i class="fab fa-microsoftteams"></i> Teams</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Wrong Answers Review -->
    <div id="wrong-answers-modal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 p-4 hidden modal-overlay">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-2xl w-full modal-content">
            <h3 class="text-2xl font-bold text-gray-800 mb-4">Review Your Answers</h3>
            <div id="wrong-answers-list">
                <!-- Wrong answers will be injected here -->
            </div>
            <button class="mt-6 bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600" onclick="document.getElementById('wrong-answers-modal').classList.add('hidden')">Close</button>
        </div>
    </div>

    <!-- Guide Modal (New) -->
    <div id="guide-modal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 p-4 modal-overlay hidden">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-xl w-full text-center modal-content">
            <h3 class="text-3xl font-bold text-gray-800 mb-4">Welcome! How to Play This Quiz</h3>
            <p class="text-lg text-gray-700 mb-6">
                This is a **fill-in-the-blank** quiz. You'll see sentences with missing words, indicated by blank spaces like this:
            </p>
            <div class="mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                <p class="text-lg text-gray-800 font-medium mb-4">
                    "This is a demo <span id="demo-blank-text" class="blank-placeholder-demo">____</span> question."
                </p>
                <button id="demo-fill-button" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition-colors">
                    Try it!
                </button>
            </div>
            <p class="text-lg text-gray-700 mb-6">
                Below each question, you'll find multiple-choice options. Select the option that correctly fills all the blanks in the sentence.
            </p>
            <button id="close-guide-button" class="start-button">Got It! Start Quiz</button>
        </div>
    </div>

    <script>
        // --- Local Storage Key ---
        const QUIZ_GUIDE_SHOWN_KEY = 'quizGuideShown';

        // --- Fallback for crypto.randomUUID() ---
        function generateUUID() {
            if (typeof crypto !== 'undefined' && crypto.randomUUID) {
                return crypto.randomUUID();
            }
            // Fallback for environments where crypto.randomUUID is not available
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // --- Quiz Questions Data (Fill-in-the-blank format) ---
        // This is a comprehensive sample. The full 166 questions would follow this structure.
        const allQuestions = [
            // LO 1: Human Resource Management
            {
                id: 'hrm1',
                question: "Human resource management is organizing, coordinating, and managing an organization’s current employees to carry out an organization’s _____, _____ and _____.",
                blanks: 3,
                options: [
                    "mission, vision, goals",
                    "products, services, sales",
                    "finances, marketing, operations",
                    "strategies, tactics, policies"
                ],
                correctAnswer: "mission, vision, goals",
                explanation: "Human resource management aligns employees with the organization's core purpose, vision, and strategic goals."
            },
            {
                id: 'hrm2',
                question: "_____ is the continuous process of improving performance by setting individual and team goals which are aligned to the strategic goals of the organisation.",
                blanks: 1,
                options: [
                    "Performance Management",
                    "Recruitment",
                    "Training",
                    "Delegation"
                ],
                correctAnswer: "Performance Management",
                explanation: "Performance management focuses on continuous improvement and goal alignment within an organization."
            },
            {
                id: 'hrm3',
                question: "_____ in human resource management is process of selecting and shortlisting the right candidates with the necessary qualifications and skill set to fill the vacancies in an organization.",
                blanks: 1,
                options: [
                    "Selection",
                    "Recruitment",
                    "Planning",
                    "Development"
                ],
                correctAnswer: "Selection",
                explanation: "Selection is the process of choosing the best candidate from a pool of applicants."
            },
            {
                id: 'hrm4',
                question: "The recruitment and selection process begins with identifying the need for a new employee or filling an existing _____.",
                blanks: 1,
                options: [
                    "vacancy",
                    "budget",
                    "project",
                    "department"
                ],
                correctAnswer: "vacancy",
                explanation: "The process starts with recognizing a need for personnel due to growth, turnover, or new roles."
            },
            {
                id: 'hrm5',
                question: "_____ may be conducted to verify the candidate's criminal history, education, and other relevant details.",
                blanks: 1,
                options: [
                    "Background Checks",
                    "Initial Interviews",
                    "Skills Evaluations",
                    "Reference Checks"
                ],
                correctAnswer: "Background Checks",
                explanation: "Background checks are crucial for verifying a candidate's credentials and history."
            },
            {
                id: 'hrm6',
                question: "Human resource planning involves forecasting the organization's future _____ needs and identifying the strategies to meet those needs.",
                blanks: 1,
                options: [
                    "workforce",
                    "financial",
                    "marketing",
                    "operational"
                ],
                correctAnswer: "workforce",
                explanation: "HR planning ensures the right number of people with the right skills are available when needed."
            },
            {
                id: 'hrm7',
                question: "The importance of human resource management for small businesses includes efficient resource utilization, improved employee morale, and enhanced organizational _____.",
                blanks: 1,
                options: [
                    "performance",
                    "profit",
                    "sales",
                    "marketing"
                ],
                correctAnswer: "performance",
                explanation: "Effective HRM directly contributes to the overall success and efficiency of a small business."
            },
            {
                id: 'hrm8',
                question: "Recruitment is the process of attracting a pool of qualified candidates for job _____.",
                blanks: 1,
                options: [
                    "vacancies",
                    "training",
                    "promotions",
                    "evaluations"
                ],
                correctAnswer: "vacancies",
                explanation: "Recruitment aims to build a strong pool of potential employees."
            },
            {
                id: 'hrm9',
                question: "Employee training and development programs help to enhance employees' skills, knowledge, and _____.",
                blanks: 1,
                options: [
                    "abilities",
                    "salaries",
                    "benefits",
                    "titles"
                ],
                correctAnswer: "abilities",
                explanation: "Training and development are crucial for improving employee capabilities and adapting to new challenges."
            },
            {
                id: 'hrm10',
                question: "A positive organizational culture, fostered by HR, can lead to increased employee engagement and reduced employee _____.",
                blanks: 1,
                options: [
                    "turnover",
                    "salaries",
                    "benefits",
                    "workload"
                ],
                correctAnswer: "turnover",
                explanation: "A strong culture helps retain employees and reduces the costs associated with high turnover."
            },

            // LO 2: Ethics and Social Corporate Responsibility
            {
                id: 'ethics1',
                question: "_____ are standards of right and wrong that prescribe what humans ought to do.",
                blanks: 1,
                options: [
                    "Ethics",
                    "Laws",
                    "Policies",
                    "Rules"
                ],
                correctAnswer: "Ethics",
                explanation: "Ethics are moral principles that guide human behavior, decisions, and actions."
            },
            {
                id: 'ethics2',
                question: "Ethical decision making refers to the process of evaluating and choosing among alternatives in a manner consistent with _____ principles.",
                blanks: 1,
                options: [
                    "ethical",
                    "financial",
                    "strategic",
                    "personal"
                ],
                correctAnswer: "ethical",
                explanation: "Ethical decision-making involves making choices that align with moral standards and a code of ethics."
            },
            {
                id: 'ethics3',
                question: "_____ and _____ norms play a significant role in shaping ethical perspectives.",
                blanks: 2,
                options: [
                    "Cultural, Societal",
                    "Economic, Political",
                    "Individual, Group",
                    "Legal, Regulatory"
                ],
                correctAnswer: "Cultural, Societal",
                explanation: "Cultural and societal norms deeply influence what is considered morally acceptable."
            },
            {
                id: 'ethics4',
                question: "Small businesses must pay employees fairly and adhere to minimum _____ and _____ laws.",
                blanks: 2,
                options: [
                    "wage, labour",
                    "tax, safety",
                    "profit, revenue",
                    "marketing, sales"
                ],
                correctAnswer: "wage, labour",
                explanation: "Fair pay and adherence to labor laws are fundamental ethical obligations for businesses."
            },
            {
                id: 'ethics5',
                question: "Corporate Social Responsibility is generally categorized in four ways: Environmental responsibility, ethical/human rights responsibility, _____ responsibility and _____ responsibility.",
                blanks: 2,
                options: [
                    "philanthropic, economic",
                    "social, legal",
                    "community, stakeholder",
                    "governance, compliance"
                ],
                correctAnswer: "philanthropic, economic",
                explanation: "CSR encompasses environmental, ethical, philanthropic, and economic dimensions of a company's operations."
            },
            {
                id: 'ethics6',
                question: "Factors that influence ethical decision-making include personal values, moral development, and organizational _____.",
                blanks: 1,
                options: [
                    "culture",
                    "profit",
                    "size",
                    "location"
                ],
                correctAnswer: "culture",
                explanation: "Organizational culture significantly impacts the ethical choices made within a business."
            },
            {
                id: 'ethics7',
                question: "Ethical issues in managing small businesses can include conflicts of interest and issues related to customer _____.",
                blanks: 1,
                options: [
                    "privacy",
                    "loyalty",
                    "feedback",
                    "satisfaction"
                ],
                correctAnswer: "privacy",
                explanation: "Protecting customer data and avoiding conflicts of interest are critical ethical considerations for small businesses."
            },
            {
                id: 'ethics8',
                question: "Environmental responsibility within CSR focuses on minimizing a business's negative impact on the _____.",
                blanks: 1,
                options: [
                    "environment",
                    "economy",
                    "society",
                    "employees"
                ],
                correctAnswer: "environment",
                explanation: "Environmental responsibility involves sustainable practices and reducing ecological footprints."
            },
            {
                id: 'ethics9',
                question: "Philanthropic responsibility in CSR involves a business contributing resources to the community and engaging in _____ activities.",
                blanks: 1,
                options: [
                    "charitable",
                    "marketing",
                    "sales",
                    "production"
                ],
                correctAnswer: "charitable",
                explanation: "Philanthropy is about giving back to society through donations and community involvement."
            },
            {
                id: 'ethics10',
                question: "Economic responsibility in CSR means a business must be profitable and provide goods and services that meet societal _____.",
                blanks: 1,
                options: [
                    "needs",
                    "wants",
                    "demands",
                    "desires"
                ],
                correctAnswer: "needs",
                explanation: "Economic responsibility is the foundation of CSR, ensuring a business's financial viability while serving society."
            },

            // LO 3: Delegation
            {
                id: 'del1',
                question: "_____ is the act of empowering a person to act for another.",
                blanks: 1,
                options: [
                    "Delegation",
                    "Supervision",
                    "Management",
                    "Control"
                ],
                correctAnswer: "Delegation",
                explanation: "Delegation involves transferring authority and responsibility for tasks to another individual."
            },
            {
                id: 'del2',
                question: "Delegation is a fundamental skill in organizational management and is essential for effective _____ and _____.",
                blanks: 2,
                options: [
                    "teamwork, productivity",
                    "planning, budgeting",
                    "reporting, analysis",
                    "innovation, creativity"
                ],
                correctAnswer: "teamwork, productivity",
                explanation: "Effective delegation enhances collaboration within teams and boosts overall output."
            },
            {
                id: 'del3',
                question: "Delegation provides opportunities for team members to develop new _____ and gain valuable _____.",
                blanks: 2,
                options: [
                    "skills, experience",
                    "contacts, networks",
                    "salaries, benefits",
                    "titles, recognition"
                ],
                correctAnswer: "skills, experience",
                explanation: "Delegating tasks allows employees to acquire new competencies and practical knowledge."
            },
            {
                id: 'del4',
                question: "Clearly define the _____ and _____ for the delegated task.",
                blanks: 2,
                options: [
                    "objectives, expectations",
                    "resources, budget",
                    "risks, challenges",
                    "timeline, milestones"
                ],
                correctAnswer: "objectives, expectations",
                explanation: "Clear objectives and expectations are vital for successful task completion when delegating."
            },
            {
                id: 'del5',
                question: "One of the primary barriers to delegation is a lack of _____ in subordinates' abilities.",
                blanks: 1,
                options: [
                    "trust",
                    "time",
                    "resources",
                    "interest"
                ],
                correctAnswer: "trust",
                explanation: "Managers often hesitate to delegate if they lack confidence in their team members' capabilities."
            },
            {
                id: 'del6',
                question: "Delegation can lead to improved employee _____ and increased job satisfaction.",
                blanks: 1,
                options: [
                    "empowerment",
                    "stress",
                    "turnover",
                    "complaints"
                ],
                correctAnswer: "empowerment",
                explanation: "Empowering employees through delegation can significantly boost their morale and satisfaction."
            },
            {
                id: 'del7',
                question: "A step in delegation is to provide the necessary _____ and authority to the person receiving the task.",
                blanks: 1,
                options: [
                    "resources",
                    "criticism",
                    "punishments",
                    "demands"
                ],
                correctAnswer: "resources",
                explanation: "Providing adequate resources ensures the delegated task can be completed effectively."
            },
            {
                id: 'del8',
                question: "Another barrier to delegation is the fear of losing _____ or control over tasks.",
                blanks: 1,
                options: [
                    "control",
                    "money",
                    "employees",
                    "customers"
                ],
                correctAnswer: "control",
                explanation: "Some managers are reluctant to delegate due to a desire to maintain full control."
            },
            {
                id: 'del9',
                question: "Effective delegation can help managers to focus on more _____ and strategic tasks.",
                blanks: 1,
                options: [
                    "important",
                    "simple",
                    "routine",
                    "unnecessary"
                ],
                correctAnswer: "important",
                explanation: "Delegation frees up a manager's time for higher-level responsibilities."
            },
            {
                id: 'del10',
                question: "When delegating, it's important to establish clear communication channels and provide regular _____.",
                blanks: 1,
                options: [
                    "feedback",
                    "orders",
                    "silence",
                    "demands"
                ],
                correctAnswer: "feedback",
                explanation: "Regular feedback helps ensure the delegated task is on track and provides learning opportunities."
            },

            // LO 4: Decision Making
            {
                id: 'dm1',
                question: "Decision making is the process of making choices by identifying a decision, gathering information and assessing _____ resolutions.",
                blanks: 1,
                options: [
                    "alternative",
                    "quick",
                    "easy",
                    "popular"
                ],
                correctAnswer: "alternative",
                explanation: "Decision making involves evaluating different options to arrive at the best course of action."
            },
            {
                id: 'dm2',
                question: "The first step in the decision-making process is the identification of the _____ or _____.",
                blanks: 2,
                options: [
                    "problem, opportunity",
                    "solution, outcome",
                    "leader, team",
                    "budget, timeline"
                ],
                correctAnswer: "problem, opportunity",
                explanation: "Recognizing the need for a decision, whether due to an issue or a chance for improvement, is the initial stage."
            },
            {
                id: 'dm3',
                question: "_____ Decision Making relies on gut feelings, instincts, or past experiences, often used when time is limited.",
                blanks: 1,
                options: [
                    "Intuitive",
                    "Rational",
                    "Programmed",
                    "Strategic"
                ],
                correctAnswer: "Intuitive",
                explanation: "Intuitive decision-making is based on quick judgments and prior experience rather than detailed analysis."
            },
            {
                id: 'dm4',
                question: "Decisions that are repetitive and follow established procedures are known as _____ or _____ Decision Making.",
                blanks: 2,
                options: [
                    "Routine, Programmed",
                    "Non-programmed, Complex",
                    "Individual, Group",
                    "Strategic, Operational"
                ],
                correctAnswer: "Routine, Programmed",
                explanation: "Programmed decisions are standardized and occur frequently, following predefined rules."
            },
            {
                id: 'dm5',
                question: "_____ Bias involves individuals overestimating their own abilities, knowledge, or the accuracy of their beliefs.",
                blanks: 1,
                options: [
                    "Overconfidence",
                    "Confirmation",
                    "Anchoring",
                    "Hindsight"
                ],
                correctAnswer: "Overconfidence",
                explanation: "Overconfidence bias leads people to have an inflated sense of their capabilities or the correctness of their judgments."
            },
            {
                id: 'dm6',
                question: "The step after gathering information in decision making is to generate _____.",
                blanks: 1,
                options: [
                    "alternatives",
                    "problems",
                    "solutions",
                    "questions"
                ],
                correctAnswer: "alternatives",
                explanation: "Brainstorming and creating various options is crucial before making a choice."
            },
            {
                id: 'dm7',
                question: "Decisions made in situations where all necessary information is available are under conditions of _____.",
                blanks: 1,
                options: [
                    "certainty",
                    "risk",
                    "uncertainty",
                    "ambiguity"
                ],
                correctAnswer: "certainty",
                explanation: "Certainty implies complete knowledge of outcomes for each alternative."
            },
            {
                id: 'dm8',
                question: "When the outcome of a decision is not known, but probabilities can be assigned, it's decision making under _____.",
                blanks: 1,
                options: [
                    "risk",
                    "certainty",
                    "uncertainty",
                    "ignorance"
                ],
                correctAnswer: "risk",
                explanation: "Risk involves making decisions when outcomes are uncertain but probabilities can be estimated."
            },
            {
                id: 'dm9',
                question: "The tendency to seek out and interpret information that confirms one's existing beliefs is called _____ Bias.",
                blanks: 1,
                options: [
                    "Confirmation",
                    "Anchoring",
                    "Availability",
                    "Framing"
                ],
                correctAnswer: "Confirmation",
                explanation: "Confirmation bias can lead to poor decisions by only considering supporting evidence."
            },
            {
                id: 'dm10',
                question: "The final step in the decision-making process is to evaluate the _____ of the implemented decision.",
                blanks: 1,
                options: [
                    "effectiveness",
                    "cost",
                    "speed",
                    "popularity"
                ],
                correctAnswer: "effectiveness",
                explanation: "Evaluating the outcome helps in learning and making better future decisions."
            },

            // LO 5: Leadership
            {
                id: 'lead1',
                question: "Leadership is the ability of an individual or a group of people to _____ and _____ followers or members of an organization, society or team.",
                blanks: 2,
                options: [
                    "influence, guide",
                    "control, dictate",
                    "manage, supervise",
                    "command, order"
                ],
                correctAnswer: "influence, guide",
                explanation: "Leadership involves inspiring and directing others towards a common goal."
            },
            {
                id: 'lead2',
                question: "_____ Leadership is a management style wherein one person controls all the decisions and takes very little inputs from other group members.",
                blanks: 1,
                options: [
                    "Autocratic",
                    "Democratic",
                    "Laissez-Faire",
                    "Transformational"
                ],
                correctAnswer: "Autocratic",
                explanation: "Autocratic leaders maintain full control and make decisions unilaterally."
            },
            {
                id: 'lead3',
                question: "_____ Leadership, also known as participative leadership, is about letting multiple people participate in the decision-making process.",
                blanks: 1,
                options: [
                    "Democratic",
                    "Autocratic",
                    "Transactional",
                    "Servant"
                ],
                correctAnswer: "Democratic",
                explanation: "Democratic leadership encourages input and participation from team members."
            },
            {
                id: 'lead4',
                question: "A good leader has a clear and inspiring _____ of the future.",
                blanks: 1,
                options: [
                    "vision",
                    "plan",
                    "budget",
                    "strategy"
                ],
                correctAnswer: "vision",
                explanation: "A compelling vision provides direction and purpose for the team."
            },
            {
                id: 'lead5',
                question: "Providing opportunities for skill development and recognizing achievements are key steps in _____ employees.",
                blanks: 1,
                options: [
                    "motivating",
                    "disciplining",
                    "evaluating",
                    "recruiting"
                ],
                correctAnswer: "motivating",
                explanation: "Investing in employee growth and acknowledging their efforts are powerful motivators."
            },
            {
                id: 'lead6',
                question: "A leader who inspires and motivates followers to achieve extraordinary outcomes and develop their full potential is a _____ leader.",
                blanks: 1,
                options: [
                    "Transformational",
                    "Transactional",
                    "Bureaucratic",
                    "Laissez-Faire"
                ],
                correctAnswer: "Transformational",
                explanation: "Transformational leaders focus on inspiring change and growth in their followers."
            },
            {
                id: 'lead7',
                question: "_____ leadership focuses on supervision, organization, and performance, using a system of rewards and punishments.",
                blanks: 1,
                options: [
                    "Transactional",
                    "Servant",
                    "Charismatic",
                    "Coaching"
                ],
                correctAnswer: "Transactional",
                explanation: "Transactional leaders operate on a system of exchanges and incentives."
            },
            {
                id: 'lead8',
                question: "A good leader demonstrates strong _____ by adhering to moral and ethical principles.",
                blanks: 1,
                options: [
                    "integrity",
                    "power",
                    "control",
                    "ambition"
                ],
                correctAnswer: "integrity",
                explanation: "Integrity is a foundational quality for building trust and respect as a leader."
            },
            {
                id: 'lead9',
                question: "One of the steps in motivating employees is to set clear and achievable _____.",
                blanks: 1,
                options: [
                    "goals",
                    "rules",
                    "deadlines",
                    "punishments"
                ],
                correctAnswer: "goals",
                explanation: "Clear goals provide direction and a sense of accomplishment for employees."
            },
            {
                id: 'lead10',
                question: "A leader's ability to communicate effectively, both verbally and non-verbally, is crucial for conveying _____ and expectations.",
                blanks: 1,
                options: [
                    "messages",
                    "orders",
                    "secrets",
                    "rumors"
                ],
                correctAnswer: "messages",
                explanation: "Clear communication ensures that the team understands objectives and expectations."
            },
            // Add more questions here following the same structure
            // Example for LO1 (Human Resource Management)
            {
                id: 'hrm11',
                question: "The process of attracting, developing, and maintaining a workforce is known as _____ management.",
                blanks: 1,
                options: [
                    "human resource",
                    "financial",
                    "operations",
                    "marketing"
                ],
                correctAnswer: "human resource",
                explanation: "Human resource management covers the entire lifecycle of an employee within an organization."
            },
            {
                id: 'hrm12',
                question: "Regular performance reviews are part of the _____ management process.",
                blanks: 1,
                options: [
                    "performance",
                    "recruitment",
                    "training",
                    "planning"
                ],
                correctAnswer: "performance",
                explanation: "Performance management includes setting goals, monitoring progress, and providing feedback."
            },
            // Example for LO2 (Ethics and Social Corporate Responsibility)
            {
                id: 'ethics11',
                question: "Making decisions based on personal gain rather than the company's best interest is an example of a _____ of _____.",
                blanks: 2,
                options: [
                    "conflict, interest",
                    "ethical, dilemma",
                    "moral, failing",
                    "legal, issue"
                ],
                correctAnswer: "conflict, interest",
                explanation: "A conflict of interest arises when personal interests interfere with professional duties."
            },
            {
                id: 'ethics12',
                question: "Corporate social responsibility goes beyond legal compliance to include ethical and _____ contributions.",
                blanks: 1,
                options: [
                    "voluntary",
                    "mandatory",
                    "financial",
                    "regulatory"
                ],
                correctAnswer: "voluntary",
                explanation: "CSR involves actions taken by a company that are not legally required but are beneficial to society."
            },
            // Example for LO3 (Delegation)
            {
                id: 'del11',
                question: "Delegation helps in skill _____ and employee _____.",
                blanks: 2,
                options: [
                    "development, empowerment",
                    "reduction, control",
                    "transfer, demotivation",
                    "stagnation, oversight"
                ],
                correctAnswer: "development, empowerment",
                explanation: "Delegation is a tool for nurturing talent and giving employees more autonomy."
            },
            {
                id: 'del12',
                question: "A barrier to delegation can be the manager's belief that they can do the task better or _____.",
                blanks: 1,
                options: [
                    "faster",
                    "cheaper",
                    "slower",
                    "worse"
                ],
                correctAnswer: "faster",
                explanation: "Some managers hesitate to delegate because they feel it's quicker to do it themselves."
            },
            // Example for LO4 (Decision Making)
            {
                id: 'dm11',
                question: "When faced with a decision, gathering relevant _____ is a crucial step.",
                blanks: 1,
                options: [
                    "information",
                    "opinions",
                    "problems",
                    "solutions"
                ],
                correctAnswer: "information",
                explanation: "Informed decisions rely on accurate and comprehensive data."
            },
            {
                id: 'dm12',
                question: "Decisions made under conditions of _____ involve incomplete information, making outcomes unpredictable.",
                blanks: 1,
                options: [
                    "uncertainty",
                    "risk",
                    "certainty",
                    "clarity"
                ],
                correctAnswer: "uncertainty",
                explanation: "Uncertainty in decision-making means outcomes are unknown and cannot be predicted with probabilities."
            },
            // Example for LO5 (Leadership)
            {
                id: 'lead11',
                question: "A leader who serves the needs of the team and organization first is known as a _____ leader.",
                blanks: 1,
                options: [
                    "Servant",
                    "Autocratic",
                    "Charismatic",
                    "Bureaucratic"
                ],
                correctAnswer: "Servant",
                explanation: "Servant leaders prioritize the growth and well-being of their followers."
            },
            {
                id: 'lead12',
                question: "Effective leaders possess strong _____ skills to articulate their vision and inspire their team.",
                blanks: 1,
                options: [
                    "communication",
                    "technical",
                    "financial",
                    "analytical"
                ],
                correctAnswer: "communication",
                explanation: "Clear and persuasive communication is vital for leadership effectiveness."
            }
        ];

        let questionsToAsk = [];
        let currentQuestionIndex = 0;
        let score = 0;
        const totalQuestionsPerSession = 20; // Changed to 20 questions per session
        let userName = "Guest";
        let challengedSharerName = null;
        let challengedSharerScore = null;
        let challengedSharerAvgSpeed = null;
        let challengedSharerProficiency = null;
        let timerInterval;
        let timeLeft = 35; // Changed to 35 seconds
        let questionStartTime;
        let totalTimeTaken = 0;
        let wrongAnswersLog = [];

        // --- DOM Elements ---
        const startScreen = document.getElementById('start-screen');
        const userNameInput = document.getElementById('user-name-input');
        const challengeIntroScreen = document.getElementById('challenge-intro-screen');
        const challengerNameDisplay = document.getElementById('challenger-name-display');
        const challengerScoreDisplay = document.getElementById('challenger-score-display');
        const challengerTotalDisplay = document.getElementById('challenger-total-display');
        const challengerSpeedDisplay = document.getElementById('challenger-speed-display');
        const challengerProficiencyDisplay = document.getElementById('challenger-proficiency-display');
        const challengerNameInput = document.getElementById('challenger-name-input');
        const startChallengeButton = document.getElementById('start-challenge-button');
        const quizScreen = document.getElementById('quiz-screen');
        const scoreCard = document.getElementById('score-card');
        const startButton = document.getElementById('start-button');
        const restartButton = document.getElementById('restart-button');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const questionCountDisplay = document.getElementById('question-count');
        const timerText = document.getElementById('timer-text');
        const timerBar = document.getElementById('timer-bar');
        const scoreTextEl = document.getElementById('score-text');
        const scoreReview = document.getElementById('score-review');
        const scoreIconDisplay = document.getElementById('score-icon-display');
        const quizAppContainer = document.getElementById('quiz-app');
        const shareWhatsappButton = document.getElementById('share-whatsapp');
        const shareFacebookButton = document.getElementById('share-facebook');
        const sharePinterestButton = document.getElementById('share-pinterest');
        const shareTeamsButton = document.getElementById('share-teams');
        const shareSection = document.getElementById('share-section');
        const challengeOutcomeMessage = document.getElementById('challenge-outcome-message');
        const averageSpeedDisplay = document.getElementById('average-speed-display');
        const proficiencyScoreDisplay = document.getElementById('proficiency-score-display');
        const reviewAnswersButton = document.getElementById('review-answers-button');
        const wrongAnswersModal = document.getElementById('wrong-answers-modal');
        const wrongAnswersList = document.getElementById('wrong-answers-list');

        // New Guide Modal DOM elements
        const guideModal = document.getElementById('guide-modal');
        const demoFillButton = document.getElementById('demo-fill-button');
        const demoBlankText = document.getElementById('demo-blank-text');
        const closeGuideButton = document.getElementById('close-guide-button');


        // --- SVG Icons for score card ---
        const scoreIcons = {
            trophy: `<svg class="score-icon text-amber-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 001.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z"></path><path d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z"></path></svg>`,
            medal: `<svg class="score-icon text-blue-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>`,
            star: `<svg class="score-icon text-yellow-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>`,
            brain: `<svg class="score-icon text-pink-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 3.5a5.5 5.5 0 00-5.5 5.5c0 1.258.468 2.41 1.25 3.317V17.5a.5.5 0 00.5.5h7.5a.5.5 0 00.5-.5v-5.183c.782-.907 1.25-2.06 1.25-3.317A5.5 5.5 0 0010 3.5zM8.5 12.5a.5.5 0 01-.5-.5V11a.5.5 0 011 0v1a.5.5 0 01-.5.5zm3 0a.5.5 0 01-.5-.5V11a.5.5 0 011 0v1a.5.5 0 01-.5.5z"></path><path d="M10 2a1 1 0 00-1 1v.5a.5.5 0 001 0V3a1 1 0 00-1-1z"></path></svg>`,
            book: `<svg class="score-icon text-green-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a1 1 0 11-2 0V4a1 1 0 00-1-1H7a1 1 0 00-1 1v12a1 1 0 11-2 0V4z" clip-rule="evenodd"></path></svg>`
        };

        // --- Utility Functions ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function showModalMessage(message) {
            const modal = document.createElement('div');
            modal.classList.add('fixed', 'inset-0', 'bg-gray-800', 'bg-opacity-75', 'flex', 'items-center', 'justify-center', 'z-50', 'p-4', 'modal-overlay');
            modal.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-xl text-center max-w-sm mx-auto modal-content">
                    <p class="text-lg font-semibold mb-4">${message}</p>
                    <button class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600" onclick="this.parentNode.parentNode.remove()">OK</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Function to get color based on percentage for dashboard
        function getScoreColor(percentage) {
            if (percentage >= 90) return 'text-green-600';
            if (percentage >= 75) return 'text-lime-600';
            if (percentage >= 50) return 'text-yellow-600';
            if (percentage >= 25) return 'text-orange-600';
            return 'text-red-600';
        }

        // --- Quiz Flow Functions ---
        function startGame(isChallenge = false) {
            let nameInputSource = isChallenge ? challengerNameInput : userNameInput;
            userName = nameInputSource.value.trim();

            if (!userName) {
                showModalMessage("Please enter your name to start the quiz!");
                return;
            }
            if (userName.length > 30) {
                showModalMessage("Name cannot exceed 30 characters.");
                return;
            }

            currentQuestionIndex = 0;
            score = 0;
            totalTimeTaken = 0;
            wrongAnswersLog = [];

            shuffleArray(allQuestions);
            questionsToAsk = allQuestions.slice(0, totalQuestionsPerSession);

            startScreen.classList.add('hidden');
            challengeIntroScreen.classList.add('hidden');
            scoreCard.classList.add('hidden');
            quizScreen.classList.remove('hidden');
            quizAppContainer.classList.add('show');

            displayQuestion();
        }

        function startTimer() {
            clearInterval(timerInterval);
            timeLeft = 35; // Set timer to 35 seconds
            questionStartTime = Date.now();
            
            timerText.textContent = `Time: ${timeLeft}s`;
            timerBar.style.width = '100%';
            timerBar.classList.remove('time-low-pulse', 'bg-red-500');
            timerBar.classList.add('bg-gradient-to-r', 'from-indigo-500', 'to-blue-500');


            timerInterval = setInterval(() => {
                timeLeft--;
                timerText.textContent = `Time: ${timeLeft}s`;
                const percentageLeft = (timeLeft / 35) * 100; // Calculate percentage based on 35s
                timerBar.style.width = `${percentageLeft}%`;

                if (timeLeft <= 5 && !timerBar.classList.contains('time-low-pulse')) {
                    timerBar.classList.remove('bg-gradient-to-r', 'from-indigo-500', 'to-blue-500');
                    timerBar.classList.add('time-low-pulse', 'bg-red-500');
                }

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    handleTimeout();
                }
            }, 1000);
        }
        
        function handleTimeout() {
            const timeTaken = (Date.now() - questionStartTime) / 1000;
            totalTimeTaken += timeTaken;

            const questionData = questionsToAsk[currentQuestionIndex];
            wrongAnswersLog.push({
                question: questionData.question,
                userAnswer: "Timed Out / No Answer",
                correctAnswer: questionData.correctAnswer,
                explanation: questionData.explanation
            });

            disableOptions(null);
            moveToNextQuestion();
        }

        function disableOptions(selectedButton) {
            const buttons = optionsContainer.querySelectorAll('.option-button');
            const correctAnswerText = questionsToAsk[currentQuestionIndex].correctAnswer;

            buttons.forEach(button => {
                button.classList.add('disabled', 'opacity-70');
                button.onclick = null;
                
                if (button.textContent === correctAnswerText) {
                    button.classList.add('correct');
                } else if (button === selectedButton) {
                    button.classList.add('incorrect');
                }
            });
        }

        function moveToNextQuestion() {
            // Fade out current question and options
            questionText.style.opacity = '0';
            optionsContainer.style.opacity = '0';

            setTimeout(() => {
                currentQuestionIndex++;
                displayQuestion();
            }, 1500); // Wait 1.5 seconds before showing the next question
        }

        function displayQuestion() {
            if (currentQuestionIndex < totalQuestionsPerSession) {
                startTimer();
                const question = questionsToAsk[currentQuestionIndex];
                
                const shuffledOptions = [...question.options];
                shuffleArray(shuffledOptions);

                // Render question with blanks
                questionText.innerHTML = ''; // Clear previous content
                const parts = question.question.split('_____');
                const fragment = document.createDocumentFragment();

                parts.forEach((part, index) => {
                    const textSpan = document.createElement('span');
                    textSpan.textContent = part;
                    fragment.appendChild(textSpan);

                    if (index < question.blanks) {
                        const blankSpan = document.createElement('span');
                        blankSpan.classList.add('blank-placeholder');
                        blankSpan.textContent = '____'; // Placeholder text
                        fragment.appendChild(blankSpan);
                    }
                });
                questionText.appendChild(fragment);

                // Render options
                optionsContainer.innerHTML = '';
                shuffledOptions.forEach(optionText => {
                    const button = document.createElement('button');
                    button.classList.add('option-button');
                    button.textContent = optionText;
                    button.onclick = () => selectAnswer(button);
                    optionsContainer.appendChild(button);
                });

                questionCountDisplay.textContent = `Question ${currentQuestionIndex + 1} of ${totalQuestionsPerSession}`;

                // Fade in new question and options
                questionText.style.transition = 'opacity 0.5s ease-in-out';
                optionsContainer.style.transition = 'opacity 0.5s ease-in-out';
                questionText.style.opacity = '1';
                optionsContainer.style.opacity = '1';
            } else {
                showScoreCard();
            }
        }
        
        function selectAnswer(selectedButton) {
            clearInterval(timerInterval);
            
            const timeTaken = (Date.now() - questionStartTime) / 1000;
            totalTimeTaken += timeTaken;

            const questionData = questionsToAsk[currentQuestionIndex];
            const correctAnswerText = questionData.correctAnswer;
            const isCorrect = selectedButton.textContent === correctAnswerText;

            // Animate words into blanks
            const blankPlaceholders = questionText.querySelectorAll('.blank-placeholder');
            const wordsToFill = selectedButton.textContent.split(',').map(word => word.trim());

            blankPlaceholders.forEach((blank, index) => {
                if (wordsToFill[index]) {
                    blank.textContent = wordsToFill[index];
                }
            });

            if (isCorrect) {
                score++;
            } else {
                wrongAnswersLog.push({
                    question: questionData.question,
                    userAnswer: selectedButton.textContent,
                    correctAnswer: questionData.correctAnswer,
                    explanation: questionData.explanation
                });
            }
            disableOptions(selectedButton);
            
            moveToNextQuestion();
        }

        function showScoreCard() {
            quizScreen.classList.add('hidden');
            scoreCard.classList.remove('hidden');
            scoreCard.classList.add('show');
            shareSection.classList.remove('hidden');

            const scorePercentage = (score / totalQuestionsPerSession) * 100;
            const averageSpeed = totalQuestionsPerSession > 0 ? (totalTimeTaken / totalQuestionsPerSession).toFixed(2) : 0;
            const proficiencyScore = scorePercentage;

            scoreTextEl.textContent = `${userName}, you scored ${score} out of ${totalQuestionsPerSession}!`;
            averageSpeedDisplay.textContent = `Average Speed: ${averageSpeed} seconds per question`;
            proficiencyScoreDisplay.textContent = `Knowledge Proficiency: ${proficiencyScore.toFixed(0)}%`;
            proficiencyScoreDisplay.className = `text-lg font-bold mb-4 ${getScoreColor(proficiencyScore)}`;


            let reviewMessage = '';
            let iconSvg = '';

            if (scorePercentage === 100) {
                reviewMessage = "Flawless Victory! You've mastered the material. You're ready for any challenge!";
                iconSvg = scoreIcons.trophy;
            } else if (scorePercentage >= 90) {
                reviewMessage = "Outstanding! You have an expert-level grasp of these topics. Well done!";
                iconSvg = scoreIcons.medal;
            } else if (scorePercentage >= 75) {
                reviewMessage = "Excellent work! Your knowledge is impressive. Keep up the great momentum!";
                iconSvg = scoreIcons.star;
            } else if (scorePercentage >= 50) {
                reviewMessage = "Good job! You're on the right track. A little more practice and you'll be an expert.";
                iconSvg = scoreIcons.brain;
            } else {
                reviewMessage = "Nice try! This was great practice. Keep reviewing the topics to be fully prepared for the real test on paper.";
                iconSvg = scoreIcons.book;
            }

            scoreReview.textContent = reviewMessage;
            scoreIconDisplay.innerHTML = iconSvg;

            if (challengedSharerName && challengedSharerScore !== null) {
                handleChallengeOutcome(averageSpeed, proficiencyScore);
            }
        }
        
        function handleChallengeOutcome(myAvgSpeed, myProficiency) {
            shareSection.classList.add('hidden');
            challengeOutcomeMessage.classList.remove('hidden');
            let outcomeText = "";
            
            if (score > challengedSharerScore) {
                outcomeText = `🎉 Congratulations! You beat ${challengedSharerName}'s score of ${challengedSharerScore}!`;
            } else if (score === challengedSharerScore) {
                if (myAvgSpeed < challengedSharerAvgSpeed) {
                    outcomeText = `🚀 Amazing! You matched ${challengedSharerName}'s score of ${challengedSharerScore} AND were faster!`;
                } else if (myProficiency > challengedSharerProficiency) {
                     outcomeText = `🧠 Fantastic! You matched ${challengedSharerName}'s score of ${challengedSharerScore} and showed higher proficiency!`;
                }
                else if (myAvgSpeed === challengedSharerAvgSpeed && myProficiency === challengedSharerProficiency) {
                    outcomeText = `🤝 You matched ${challengedSharerName}'s score of ${challengedSharerScore} and speed! A true competitor!`;
                } else {
                    outcomeText = `🤝 You matched ${challengedSharerName}'s score of ${challengedSharerScore}!`;
                }
            } else {
                outcomeText = `Keep going! You didn't beat ${challengedSharerName}'s score of ${challengedSharerScore} this time.`;
            }
            challengeOutcomeMessage.textContent = outcomeText;
            
            // Clear challenge specific variables after outcome is displayed
            challengedSharerName = null;
            challengedSharerScore = null;
            challengedSharerAvgSpeed = null;
            challengedSharerProficiency = null;
            challengerSpeedDisplay.textContent = "";
            challengerProficiencyDisplay.textContent = "";
            challengerTotalDisplay.textContent = ""; // Clear total questions display
        }

        function resetQuiz() {
            scoreCard.classList.remove('show');
            quizAppContainer.classList.remove('show'); 
            
            setTimeout(() => {
                userNameInput.value = "";
                challengerNameInput.value = "";
                startScreen.classList.remove('hidden');
                challengeIntroScreen.classList.add('hidden');
                quizScreen.classList.add('hidden');
                scoreCard.classList.add('hidden');
                challengeOutcomeMessage.classList.add('hidden');
                averageSpeedDisplay.textContent = ""; 
                proficiencyScoreDisplay.textContent = ""; 
                proficiencyScoreDisplay.classList.remove('text-red-600', 'text-orange-600', 'text-yellow-600', 'text-lime-600', 'text-green-600');
                proficiencyScoreDisplay.classList.add('text-lg', 'font-bold', 'mb-4');
                
                quizAppContainer.classList.add('show'); 
            }, 500);
        }

        // --- Share Functions ---
        function getShareUrl() {
            const currentAvgSpeed = totalQuestionsPerSession > 0 ? (totalTimeTaken / totalQuestionsPerSession).toFixed(2) : 0;
            const currentProficiency = (score / totalQuestionsPerSession) * 100;

            const params = new URLSearchParams();
            params.set('cn', encodeURIComponent(userName)); // Challenger Name (cn)
            params.set('cs', score); // Challenger Score (cs)
            params.set('ct', totalQuestionsPerSession); // Challenger Total Questions (ct)
            params.set('ca', currentAvgSpeed); // Challenger Average Speed (ca)
            params.set('cp', currentProficiency.toFixed(0)); // Challenger Proficiency

            // For wrong answers, due to URL length limits, we will not embed the full log
            // Instead, the review button provides the review on the current session.
            // If a user clicks a challenge link, they start fresh.
            
            return `${window.location.origin}${window.location.pathname}?${params.toString()}`;
        }

        function getShareText() {
            const currentProficiency = (score / totalQuestionsPerSession) * 100;
            let achievement = "";
            if (currentProficiency === 100) achievement = "a perfect score";
            else if (currentProficiency >= 90) achievement = "an outstanding score";
            else if (currentProficiency >= 75) achievement = "an excellent score";
            else if (currentProficiency >= 50) achievement = "a good score";
            else achievement = "a solid score";

            return encodeURIComponent(`${userName} achieved ${achievement} (${score}/${totalQuestionsPerSession}) on the Entrepreneurship Exam Prep Quiz! Think you can beat my score?`);
        }
        
        function setupShareListeners() {
            const shareButtons = [
                { el: shareWhatsappButton, getUrl: () => `https://wa.me/?text=${getShareText()}%0A${encodeURIComponent(getShareUrl())}` },
                { el: shareFacebookButton, getUrl: () => `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(getShareUrl())}&quote=${getShareText()}` },
                { el: sharePinterestButton, getUrl: () => `https://pinterest.com/pin/create/button/?url=${encodeURIComponent(getShareUrl())}&description=${getShareText()}` },
                { el: shareTeamsButton, getUrl: () => `https://teams.microsoft.com/share?msgText=${getShareText()}&mask=false&href=${encodeURIComponent(getShareUrl())}` }
            ];
            shareButtons.forEach(btn => {
                btn.el.onclick = () => {
                    window.open(btn.getUrl(), '_blank');
                };
            });
        }

        // --- Challenge Logic ---
        function checkChallengeInUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            
            const name = urlParams.get('cn'); // Challenger Name (cn)
            const scoreParam = urlParams.get('cs'); // Challenger Score (cs)
            const totalParam = urlParams.get('ct'); // Challenger Total Questions (ct)
            const speedParam = urlParams.get('ca'); // Challenger Average Speed (ca)
            const proficiencyParam = urlParams.get('cp'); // Challenger Proficiency (cp)

            if (name && scoreParam !== null && totalParam !== null && speedParam !== null && proficiencyParam !== null) {
                challengedSharerName = decodeURIComponent(name);
                challengedSharerScore = parseInt(scoreParam);
                challengedSharerAvgSpeed = parseFloat(speedParam);
                challengedSharerProficiency = parseFloat(proficiencyParam);

                startScreen.classList.add('hidden');
                challengeIntroScreen.classList.remove('hidden');
                // quizAppContainer.classList.add('show'); // Will be shown by closeGuide if guide is present
                
                challengerNameDisplay.textContent = challengedSharerName;
                challengerScoreDisplay.textContent = challengedSharerScore;
                challengerTotalDisplay.textContent = totalParam; // Display total questions challenged on
                
                challengerScoreDisplay.classList.add(getScoreColor((challengedSharerScore / parseInt(totalParam)) * 100));

                challengerSpeedDisplay.textContent = `Average Speed: ${challengedSharerAvgSpeed} seconds/question`;
                challengerProficiencyDisplay.textContent = `Knowledge Proficiency: ${challengedSharerProficiency}%`;
                challengerProficiencyDisplay.classList.add(getScoreColor(challengedSharerProficiency));
                
            } else {
                // startScreen.classList.remove('hidden'); // Will be shown by closeGuide if guide is present
                // quizAppContainer.classList.add('show'); // Will be shown by closeGuide if guide is present
            }
        }

        // --- Wrong Answers Review Modal Functions ---
        function showWrongAnswersModal() {
            wrongAnswersList.innerHTML = ''; // Clear previous content

            if (wrongAnswersLog.length === 0) {
                wrongAnswersList.innerHTML = '<p class="text-gray-600 text-center">Great job! You got all questions correct or answered them all within the time limit!</p>';
            } else {
                wrongAnswersLog.forEach((item, index) => {
                    const div = document.createElement('div');
                    div.classList.add('mb-4', 'p-4', 'border', 'rounded-lg', 'bg-red-50', 'text-left', 'border-red-200');
                    div.innerHTML = `
                        <p class="font-semibold text-gray-800 mb-2">Question ${index + 1}: ${item.question.replace(/_____/g, '____')}</p>
                        <p class="text-red-600 mb-1"><i class="fas fa-times-circle mr-2"></i>Your Answer: <span class="font-medium">${item.userAnswer}</span></p>
                        <p class="text-green-600"><i class="fas fa-check-circle mr-2"></i>Correct Answer: <span class="font-medium">${item.correctAnswer}</span></p>
                        ${item.explanation ? `<p class="text-sm text-gray-500 mt-2">Explanation: ${item.explanation}</p>` : ''}
                    `;
                    wrongAnswersList.appendChild(div);
                });
            }
            wrongAnswersModal.classList.remove('hidden');
        }

        // --- Guide Modal Functions (New) ---
        function showGuide() {
            guideModal.classList.remove('hidden');
            quizAppContainer.classList.add('hidden'); // Hide main app while guide is open
            // Initialize demo blank
            demoBlankText.textContent = '____';
            demoBlankText.classList.remove('filled'); // Ensure it's not filled initially
        }

        function closeGuide() {
            localStorage.setItem(QUIZ_GUIDE_SHOWN_KEY, 'true');
            guideModal.classList.add('hidden');
            quizAppContainer.classList.remove('hidden'); // Show main app container
            
            // Determine which initial screen to show based on challenge status
            if (challengedSharerName) {
                challengeIntroScreen.classList.remove('hidden');
                startScreen.classList.add('hidden'); // Ensure start screen is hidden
            } else {
                startScreen.classList.remove('hidden');
                challengeIntroScreen.classList.add('hidden'); // Ensure challenge screen is hidden
            }
            quizAppContainer.classList.add('show'); // Trigger fade-in animation
        }

        // --- Event Listeners ---
        window.addEventListener('load', () => {
            checkChallengeInUrl(); // Check for challenge params first
            setupShareListeners();

            // If guide has not been shown, display it
            if (localStorage.getItem(QUIZ_GUIDE_SHOWN_KEY) !== 'true') {
                showGuide();
            } else {
                // If guide already shown, ensure the correct initial screen is visible
                // and the main app container is shown.
                if (challengedSharerName) {
                    challengeIntroScreen.classList.remove('hidden');
                } else {
                    startScreen.classList.remove('hidden');
                }
                quizAppContainer.classList.add('show');
            }
        });

        startButton.addEventListener('click', () => startGame(false));
        startChallengeButton.addEventListener('click', () => startGame(true));
        restartButton.addEventListener('click', resetQuiz);
        reviewAnswersButton.addEventListener('click', showWrongAnswersModal);

        // Guide modal event listeners
        demoFillButton.addEventListener('click', () => {
            if (demoBlankText.textContent === '____') {
                demoBlankText.textContent = 'FILLED';
                demoBlankText.classList.add('filled');
            } else {
                demoBlankText.textContent = '____'; // Reset for re-demo
                demoBlankText.classList.remove('filled');
            }
        });
        closeGuideButton.addEventListener('click', closeGuide);

    </script>
</body>
</html>
